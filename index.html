<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>MD.Flow | High-End Markdown to PDF</title>
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&family=JetBrains+Mono:wght@400;700&family=Merriweather:wght@300;700&display=swap" rel="stylesheet">
    
    <!-- Icons -->
    <script src="https://unpkg.com/phosphor-icons"></script>

    <!-- Libs (Marked, Highlight, HTML2PDF) -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/atom-one-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"></script>

    <style>
        :root {
            --bg-body: #050505;
            --bg-panel: #111111;
            --accent: #00f2ff; /* Cyber Cyan */
            --accent-dim: rgba(0, 242, 255, 0.1);
            --text-main: #e0e0e0;
            --text-muted: #888888;
            --border: #333333;
            --radius: 12px;
            --font-ui: 'Inter', sans-serif;
            --font-code: 'JetBrains Mono', monospace;
            --font-doc: 'Merriweather', serif;
        }

        * { box-sizing: border-box; outline: none; }
        
        body {
            margin: 0;
            background-color: var(--bg-body);
            color: var(--text-main);
            font-family: var(--font-ui);
            height: 100vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        /* --- Header / Toolbar --- */
        header {
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 20px;
            border-bottom: 1px solid var(--border);
            background: rgba(17, 17, 17, 0.8);
            backdrop-filter: blur(10px);
            z-index: 100;
        }

        .brand { font-weight: 700; letter-spacing: -0.5px; font-size: 1.2rem; display: flex; align-items: center; gap: 10px; }
        .brand span { color: var(--accent); }

        .actions { display: flex; gap: 10px; }

        button {
            background: var(--bg-panel);
            border: 1px solid var(--border);
            color: var(--text-main);
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-family: var(--font-ui);
            font-size: 0.9rem;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        button:hover { border-color: var(--text-muted); background: #1a1a1a; }
        
        button.primary {
            background: var(--accent);
            color: #000;
            border-color: var(--accent);
            font-weight: 600;
            box-shadow: 0 0 15px var(--accent-dim);
        }
        button.primary:hover {
            box-shadow: 0 0 25px rgba(0, 242, 255, 0.4);
            transform: translateY(-1px);
        }

        /* --- Workspace --- */
        .workspace {
            display: grid;
            grid-template-columns: 1fr 1fr; /* Default PC Split */
            flex: 1;
            overflow: hidden;
            position: relative;
        }

        /* Editor Side */
        .pane {
            display: flex;
            flex-direction: column;
            position: relative;
        }

        .pane-header {
            padding: 10px 20px;
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--text-muted);
            border-bottom: 1px solid var(--border);
            background: var(--bg-body);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        textarea#markdown-input {
            flex: 1;
            background: var(--bg-body);
            color: var(--text-main);
            border: none;
            resize: none;
            padding: 20px;
            font-family: var(--font-code);
            font-size: 14px;
            line-height: 1.6;
            scrollbar-width: thin;
            scrollbar-color: var(--border) var(--bg-body);
        }

        /* Preview Side */
        .preview-container {
            background: #222; /* Contrast for "paper" feel */
            overflow-y: auto;
            padding: 40px;
            display: flex;
            justify-content: center;
            scrollbar-width: thin;
            scrollbar-color: var(--border) #222;
        }

        /* The "Paper" */
        #preview-render {
            background: white;
            color: #333; /* Always dark text on paper */
            width: 210mm; /* A4 width */
            min-height: 297mm;
            padding: 20mm;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            font-family: var(--font-doc);
            font-size: 11pt; /* Print standard */
            line-height: 1.6;
        }

        /* Mobile View Toggle Logic */
        .mobile-tabs { display: none; }

        /* Settings Modal (Overlay) */
        .settings-overlay {
            position: absolute;
            top: 0; right: -400px;
            width: 350px;
            height: 100%;
            background: rgba(15, 15, 15, 0.95);
            backdrop-filter: blur(20px);
            border-left: 1px solid var(--border);
            transition: right 0.3s cubic-bezier(0.16, 1, 0.3, 1);
            z-index: 200;
            display: flex;
            flex-direction: column;
            padding: 20px;
            box-shadow: -10px 0 30px rgba(0,0,0,0.5);
        }

        .settings-overlay.open { right: 0; }

        .settings-title {
            font-size: 1.2rem;
            margin-bottom: 20px;
            font-weight: 600;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .setting-group { margin-bottom: 20px; }
        .setting-label { display: block; margin-bottom: 8px; font-size: 0.85rem; color: var(--text-muted); }
        
        textarea.css-editor {
            width: 100%;
            height: 150px;
            background: #000;
            border: 1px solid var(--border);
            color: #a5f3fc;
            font-family: var(--font-code);
            font-size: 12px;
            padding: 10px;
            border-radius: 6px;
        }

        /* --- PDF Generation CSS (Applied to the rendered HTML) --- */
        /* Note: Styles inside #preview-render will be controlled by user CSS too */
        #preview-render h1, #preview-render h2, #preview-render h3 {
            font-family: 'Inter', sans-serif;
            color: #111;
            margin-top: 1.5em;
            margin-bottom: 0.5em;
        }
        #preview-render h1 { border-bottom: 2px solid #000; padding-bottom: 10px; }
        #preview-render pre { background: #f4f4f4; padding: 10px; border-radius: 4px; border: 1px solid #ddd; overflow-x: hidden; white-space: pre-wrap; }
        #preview-render code { font-family: 'JetBrains Mono', monospace; background: rgba(0,0,0,0.05); padding: 2px 4px; border-radius: 3px; font-size: 0.9em; }
        #preview-render pre code { background: none; padding: 0; color: #333; }
        #preview-render blockquote { border-left: 4px solid var(--accent); margin: 0; padding-left: 15px; color: #555; font-style: italic; }
        #preview-render img { max-width: 100%; height: auto; display: block; margin: 20px auto; }
        #preview-render table { width: 100%; border-collapse: collapse; margin: 20px 0; }
        #preview-render th, #preview-render td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        #preview-render th { background-color: #f2f2f2; }

        /* --- Responsive Design --- */
        @media (max-width: 900px) {
            .workspace { grid-template-columns: 1fr; }
            .preview-container { display: none; } /* Hidden by default on mobile */
            
            .mobile-tabs {
                display: flex;
                position: fixed;
                bottom: 20px;
                left: 50%;
                transform: translateX(-50%);
                background: rgba(30,30,30,0.9);
                border: 1px solid var(--border);
                border-radius: 50px;
                padding: 5px;
                gap: 5px;
                z-index: 150;
                backdrop-filter: blur(10px);
                box-shadow: 0 10px 20px rgba(0,0,0,0.3);
            }
            
            .tab-btn {
                padding: 10px 20px;
                border-radius: 40px;
                background: transparent;
                border: none;
                color: var(--text-muted);
                font-weight: 600;
            }
            
            .tab-btn.active { background: var(--text-main); color: #000; }

            /* Mobile States */
            body.show-preview .pane { display: none; }
            body.show-preview .preview-container { display: flex; padding: 20px; background: #111; }
            body.show-preview #preview-render { width: 100%; padding: 15mm; min-height: auto; box-shadow: none; }
            
            .brand span:last-child { display: none; } /* Hide text logo on small screens */
            
            .settings-overlay { width: 100%; right: -100%; }
        }
    </style>
</head>
<body>

    <header>
        <div class="brand">
            <i class="ph-file-code" style="font-size: 24px; color: var(--accent);"></i>
            <span>MD.Flow</span>
        </div>
        <div class="actions">
            <button onclick="toggleSettings()"><i class="ph-sliders"></i> <span class="desktop-only">Design</span></button>
            <button class="primary" onclick="generatePDF()"><i class="ph-download-simple"></i> <span class="desktop-only">Export PDF</span></button>
        </div>
    </header>

    <div class="workspace">
        <!-- Input Area -->
        <div class="pane" id="editor-pane">
            <div class="pane-header">
                <span>Markdown Input</span>
                <label for="file-upload" style="cursor: pointer; color: var(--accent);"><i class="ph-upload-simple"></i> Datei laden</label>
                <input type="file" id="file-upload" accept=".md,.txt" style="display: none;" onchange="loadFile(this)">
            </div>
            <textarea id="markdown-input" spellcheck="false" placeholder="# Schreib hier dein Meisterwerk..."></textarea>
        </div>

        <!-- Preview Area -->
        <div class="preview-container" id="preview-pane">
            <div id="preview-render"></div>
        </div>
    </div>

    <!-- Mobile Navigation -->
    <div class="mobile-tabs">
        <button class="tab-btn active" onclick="switchTab('editor')">Editor</button>
        <button class="tab-btn" onclick="switchTab('preview')">Preview</button>
    </div>

    <!-- Settings Drawer -->
    <div class="settings-overlay" id="settings-drawer">
        <div class="settings-title">
            Style Config
            <i class="ph-x" style="cursor: pointer;" onclick="toggleSettings()"></i>
        </div>
        
        <div class="setting-group">
            <span class="setting-label">Seitenränder (mm)</span>
            <input type="number" id="margin-set" value="20" style="background:#222; border:1px solid #333; color:white; padding:5px; border-radius:4px; width:100%;">
        </div>

        <div class="setting-group">
            <span class="setting-label">Custom CSS (Wirkt nur auf PDF/Preview)</span>
            <textarea id="custom-css" class="css-editor" spellcheck="false">
/* Beispiel: Blaue Überschriften */
h1 { 
  color: #0044cc !important; 
  text-transform: uppercase;
}
/* Font anpassen */
body {
  font-family: 'Merriweather', serif;
}
</textarea>
        </div>
        
        <button onclick="updateStyles()" style="width:100%; justify-content:center; margin-top: 10px;">Apply Styles</button>
    </div>

    <!-- Dynamic Style Tag for User CSS -->
    <style id="user-style-injection"></style>

    <script>
        // --- Init & Configuration ---
        const inputArea = document.getElementById('markdown-input');
        const previewArea = document.getElementById('preview-render');
        const userStyleTag = document.getElementById('user-style-injection');

        // Initial Demo Text
        const defaultText = `# Hallo Welt!
Dies ist **MD.Flow**. Der Markdown Editor, der nicht nervt.

## Features
- [x] Live Preview
- [x] Mobile Optimized
- [x] Custom CSS Injection
- [x] Client-side PDF Generation

> "Design is intelligence made visible."

### Code Beispiel
\`\`\`javascript
const outstanding = true;
if (outstanding) {
    console.log("Das ist Webdesign!");
}
\`\`\`

| Feature | Status |
| :--- | :--- |
| UI | Clean |
| UX | Smooth |
`;
        
        inputArea.value = defaultText;

        // --- Markdown Parsing Logic ---
        marked.setOptions({
            highlight: function(code, lang) {
                const language = highlight.getLanguage(lang) ? lang : 'plaintext';
                return highlight.highlight(code, { language }).value;
            },
            breaks: true
        });

        function render() {
            const md = inputArea.value;
            previewArea.innerHTML = marked.parse(md);
        }

        // Live Rendering Event
        inputArea.addEventListener('input', render);
        
        // --- Settings & CSS ---
        function toggleSettings() {
            document.getElementById('settings-drawer').classList.toggle('open');
        }

        function updateStyles() {
            const customCSS = document.getElementById('custom-css').value;
            // Wir wrappen das CSS in #preview-render, damit es nicht die UI kaputt macht
            // Aber für PDF brauchen wir es globaler... Trick:
            // Wir ersetzen 'body' im CSS String durch '#preview-render' für die Vorschau
            let previewCSS = customCSS.replace(/body/g, '#preview-render');
            userStyleTag.innerHTML = previewCSS;
            toggleSettings();
        }

        // --- File Upload ---
        function loadFile(input) {
            const file = input.files[0];
            const reader = new FileReader();
            reader.onload = (e) => {
                inputArea.value = e.target.result;
                render();
            };
            reader.readAsText(file);
        }

        // --- Mobile Logic ---
        function switchTab(tab) {
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            if (tab === 'editor') {
                document.body.classList.remove('show-preview');
                document.querySelector('button[onclick="switchTab(\'editor\')"]').classList.add('active');
            } else {
                document.body.classList.add('show-preview');
                document.querySelector('button[onclick="switchTab(\'preview\')"]').classList.add('active');
            }
        }

        // --- PDF Generation ---
        function generatePDF() {
            const element = document.getElementById('preview-render');
            const margin = document.getElementById('margin-set').value;
            
            // Temporäres Styling für den Print-Prozess um Hintergrundfarben sicherzustellen
            const opt = {
                margin:       parseInt(margin),
                filename:     'md-flow-document.pdf',
                image:        { type: 'jpeg', quality: 0.98 },
                html2canvas:  { scale: 2, useCORS: true, letterRendering: true }, 
                jsPDF:        { unit: 'mm', format: 'a4', orientation: 'portrait' }
            };

            // Button Feedback
            const btn = document.querySelector('button.primary');
            const originalText = btn.innerHTML;
            btn.innerHTML = '<i class="ph-spinner ph-spin"></i> Rendering...';

            html2pdf().set(opt).from(element).save().then(() => {
                btn.innerHTML = originalText;
            });
        }

        // Initial Render
        render();
        updateStyles();

    </script>
</body>
</html>
