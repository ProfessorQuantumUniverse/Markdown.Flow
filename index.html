<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>MD.Flow Suite | The Ultimate Markup Environment</title>
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500;700&family=Merriweather:wght@300;400;700&family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Icons -->
    <script src="https://cdn.jsdelivr.net/npm/@phosphor-icons/web@2.1.2"></script>

    <!-- Style -->
    <link rel="stylesheet" href="style.css">

    <!-- Scripts -->
    <script src="script.js" defer></script>

    <!-- Libs -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/html2pdf.js@0.10.1/dist/html2pdf.bundle.min.js" defer></script>
    <script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.7.0/build/highlight.min.js" defer></script>

</head>
<body data-theme="cyber">

    <!-- Hidden File Input -->
    <input type="file" id="file-upload-input" accept=".md,.markdown,.txt" multiple>

    <header>
        <div class="brand">
            <div class="brand-icon">
                <i class="ph ph-flow-arrow-bold"></i>
            </div>
            <div class="brand-text">
                MD.Flow <span class="badge">Suite</span>
                <small>Ultimate Markup Environment</small>
            </div>
        </div>
        <div class="controls">
            <button class="btn btn-icon" id="header-sidebar-btn" onclick="toggleSidebar()" title="Toggle Sidebar"><i class="ph ph-sidebar-simple"></i></button>
            <button class="btn btn-icon" onclick="toggleZen()" title="Zen Mode"><i class="ph ph-corners-out"></i></button>
            <button class="btn" id="btn-styles" onclick="openStyleEditor()" title="Style Editor"><i class="ph ph-paint-brush"></i> <span>Styles</span></button>
            <button class="btn btn-icon" id="btn-settings" onclick="openSettings()" title="Settings"><i class="ph ph-gear"></i></button>
            <button
             class="btn primary" onclick="exportPDF()">
             <div class="wrapper">
                <i class="ph ph-file-pdf"></i><span>Export PDF</span>
                <div class="circle circle-12"></div>
                <div class="circle circle-11"></div>
                <div class="circle circle-10"></div>
                <div class="circle circle-9"></div>
                <div class="circle circle-8"></div>
                <div class="circle circle-7"></div>
                <div class="circle circle-6"></div>
                <div class="circle circle-5"></div>
                <div class="circle circle-4"></div>
                <div class="circle circle-3"></div>
                <div class="circle circle-2"></div>
                <div class="circle circle-1"></div>
             </div>
            </button>
            <button class="btn btn-icon" onclick="downloadMD()" title="Download .md"><i class="ph ph-download"></i></button>
        </div>
    </header>

    <!-- Toolbar -->
    <div class="toolbar">
        <button class="tool-btn" onclick="triggerFileUpload()" title="Upload MD File"><i class="ph ph-upload-simple"></i></button>
        <div class="divider"></div>
        <div class="toolbar-group">
            <button class="tool-btn" onclick="insert('**', '**')" title="Bold"><i class="ph ph-text-b"></i></button>
            <button class="tool-btn" onclick="insert('*', '*')" title="Italic"><i class="ph ph-text-italic"></i></button>
            <button class="tool-btn" onclick="insert('~~', '~~')" title="Strikethrough"><i class="ph ph-text-strikethrough"></i></button>
            <button class="tool-btn" onclick="insert('<u>', '</u>')" title="Underline"><i class="ph ph-text-underline"></i></button>
        </div>
        <div class="divider"></div>
        <div class="toolbar-group">
            <button class="tool-btn" onclick="insert('# ', '')" title="Heading 1"><i class="ph ph-text-h-one"></i></button>
            <button class="tool-btn" onclick="insert('## ', '')" title="Heading 2"><i class="ph ph-text-h-two"></i></button>
            <button class="tool-btn" onclick="insert('### ', '')" title="Heading 3"><i class="ph ph-text-h-three"></i></button>
        </div>
        <div class="divider"></div>
        <div class="toolbar-group">
            <button class="tool-btn" onclick="insert('`', '`')" title="Inline Code"><i class="ph ph-code"></i></button>
            <button class="tool-btn" onclick="insert('\n```\n', '\n```\n')" title="Code Block"><i class="ph ph-code-block"></i></button>
            <button class="tool-btn" onclick="insert('> ', '')" title="Quote"><i class="ph ph-quotes"></i></button>
        </div>
        <div class="divider"></div>
        <div class="toolbar-group">
            <button class="tool-btn" onclick="insert('[', '](url)')" title="Link"><i class="ph ph-link"></i></button>
            <button class="tool-btn" onclick="insert('![alt]', '(url)')" title="Image"><i class="ph ph-image"></i></button>
            <button class="tool-btn" onclick="insert('\n| H1 | H2 | H3 |\n|:---|:---:|---:|\n| L | C | R |', '')" title="Table"><i class="ph ph-table"></i></button>
        </div>
        <div class="divider"></div>
        <div class="toolbar-group">
            <button class="tool-btn" onclick="insert('- ', '')" title="Bullet List"><i class="ph ph-list-bullets"></i></button>
            <button class="tool-btn" onclick="insert('1. ', '')" title="Numbered List"><i class="ph ph-list-numbers"></i></button>
            <button class="tool-btn" onclick="insert('- [ ] ', '')" title="Task List"><i class="ph ph-check-square"></i></button>
        </div>
        <div class="divider"></div>
        <button class="tool-btn" onclick="insert('\n---\n', '')" title="Horizontal Rule"><i class="ph ph-minus"></i></button>
        <button class="tool-btn" onclick="insert('\n\\newpage\n', '')" title="Page Break"><i class="ph ph-scissors"></i></button>
        <div class="divider"></div>
        <button class="tool-btn" onclick="downloadHTML()" title="Export to HTML"><i class="ph ph-file-html"></i></button>
    </div>

    <div class="workspace">
        <!-- Sidebar -->
        <div class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="sidebar-title">
                    <i class="ph ph-folder-open"></i> Files
                </div>
                <button class="btn btn-icon" onclick="toggleSidebar()" style="padding: 4px;"><i class="ph ph-x"></i></button>
            </div>
            <div class="sidebar-content">
                
                <!-- Mobile Actions -->
                <div class="mobile-menu-items">
                    <div class="recent-files-title">Actions</div>
                    <button class="file-item" style="width: 100%; text-align: left; color: var(--text-main); font-family: inherit; font-size: inherit;" onclick="toggleZen(); toggleSidebar()">
                        <i class="ph ph-corners-out"></i> <span class="file-item-name">Zen Mode</span>
                    </button>
                    <button class="file-item" style="width: 100%; text-align: left; color: var(--text-main); font-family: inherit; font-size: inherit;" onclick="downloadMD(); toggleSidebar()">
                        <i class="ph ph-download"></i> <span class="file-item-name">Download .md</span>
                    </button>
                    <div class="section-divider" style="margin: 12px 0;"></div>
                </div>

                <!-- Upload Zone -->
                <div class="upload-zone" id="upload-zone" onclick="triggerFileUpload()">
                    <i class="ph ph-cloud-arrow-up"></i>
                    <p>Drop <span>.md</span> files here<br>or click to browse</p>
                </div>

                <!-- Recent Files -->
                <div class="recent-files-title">Recent Files</div>
                <div id="recent-files-list">
                    <!-- Files will be populated by JS -->
                </div>
            </div>
        </div>

        <!-- Editor -->
        <div class="editor-container" id="editor-box">
            <textarea id="markdown-input" placeholder="Start writing your masterpiece...&#10;&#10;Drop a .md file here or use the toolbar above to format your text." spellcheck="false"></textarea>
        </div>

        <!-- Preview -->
        <div class="preview-container mobile-hidden" id="preview-box">
            <style id="custom-preview-styles"></style>
            <div id="preview-render"></div>
        </div>
    </div>

    <!-- Mobile Tabs -->
    <div class="glass-radio-group">
        <input type="radio" name="plan" onclick="switchTab('editor')" id="glass-editor" checked="" />
        <label for="glass-editor">Editor</label>

        <input type="radio" name="plan" onclick="switchTab('preview')" id="glass-preview" />
        <label for="glass-preview">Preview</label>

        <div class="glass-glider"></div>
    </div>

    <!-- Status Bar -->
    <div class="status-bar">
        <div class="stats-group">
            <span class="stat-item"><i class="ph ph-text-aa"></i> <span id="stat-words">0</span> words</span>
            <div class="stat-divider"></div>
            <span class="stat-item"><i class="ph ph-hash"></i> <span id="stat-chars">0</span> chars</span>
            <div class="stat-divider"></div>
            <span class="stat-item"><i class="ph ph-rows"></i> <span id="stat-lines">0</span> lines</span>
        </div>
        <div class="stats-group">
            <span id="current-file-name" class="stat-item"><i class="ph ph-file-text"></i> Untitled</span>
            <div class="stat-divider"></div>
            <span id="save-status" class="stat-item"><i class="ph ph-check-circle"></i> Auto-saved</span>
        </div>
    </div>

    <!-- Toast Container -->
    <div class="toast-container" id="toast-container"></div>

    <!-- Settings Modal -->
    <div class="overlay" id="settings-modal" onclick="if(event.target === this) closeSettings()">
        <div class="modal">
            <div class="modal-header">
                <h2><i class="ph ph-gear"></i> Settings</h2>
                <button class="modal-close" onclick="closeSettings()"><i class="ph ph-x"></i></button>
            </div>
            <div class="modal-body">
                <label class="form-label">Interface Theme</label>
                <div class="theme-grid" id="theme-grid">
                    <div class="theme-card" data-theme="cyber" onclick="setTheme('cyber')">
                        <div class="theme-preview">
                            <div class="theme-preview-bg" style="background: #050505;"></div>
                            <div class="theme-preview-accent" style="background: #00f2ff;"></div>
                        </div>
                        <div class="theme-card-name">Cyber</div>
                    </div>
                    <div class="theme-card" data-theme="nord" onclick="setTheme('nord')">
                        <div class="theme-preview">
                            <div class="theme-preview-bg" style="background: #2e3440;"></div>
                            <div class="theme-preview-accent" style="background: #88c0d0;"></div>
                        </div>
                        <div class="theme-card-name">Nord</div>
                    </div>
                    <div class="theme-card" data-theme="paper" onclick="setTheme('paper')">
                        <div class="theme-preview">
                            <div class="theme-preview-bg" style="background: #f8f9fa;"></div>
                            <div class="theme-preview-accent" style="background: #6366f1;"></div>
                        </div>
                        <div class="theme-card-name">Paper</div>
                    </div>
                    <div class="theme-card" data-theme="midnight" onclick="setTheme('midnight')">
                        <div class="theme-preview">
                            <div class="theme-preview-bg" style="background: #0f0f23;"></div>
                            <div class="theme-preview-accent" style="background: #ffd700;"></div>
                        </div>
                        <div class="theme-card-name">Midnight</div>
                    </div>
                    <div class="theme-card" data-theme="forest" onclick="setTheme('forest')">
                        <div class="theme-preview">
                            <div class="theme-preview-bg" style="background: #0d1117;"></div>
                            <div class="theme-preview-accent" style="background: #3fb950;"></div>
                        </div>
                        <div class="theme-card-name">Forest</div>
                    </div>
                </div>

                <div class="section-divider"><span>Export Options</span></div>
                
                <div class="form-row">
                    <button class="btn secondary" onclick="downloadHTML()"><i class="ph ph-file-html"></i> Export HTML</button>
                    <button class="btn secondary" onclick="exportPDF()"><i class="ph ph-file-pdf"></i> Export PDF</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Style Editor Modal -->
    <div class="overlay" id="style-modal" onclick="if(event.target === this) closeStyleEditor()">
        <div class="modal" style="width: 700px;">
            <div class="modal-header">
                <h2><i class="ph ph-paint-brush"></i> Document Style Editor</h2>
                <button class="modal-close" onclick="closeStyleEditor()"><i class="ph ph-x"></i></button>
            </div>
            <div class="modal-body">
                <!-- Mode Tabs -->
                <div class="modal-tabs">
                    <button class="modal-tab active" onclick="switchStyleTab('visual')" id="tab-visual">
                        <i class="ph ph-sliders"></i> Visual Editor
                    </button>
                    <button class="modal-tab" onclick="switchStyleTab('code')" id="tab-code">
                        <i class="ph ph-code"></i> CSS Code
                    </button>
                </div>

                <!-- Visual Editor Tab -->
                <div class="tab-content active" id="content-visual">
                    <div class="section-divider"><span>Typography</span></div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Body Font</label>
                            <select class="form-select" id="style-font-body" onchange="updateVisualStyle()">
                                <option value="'Merriweather', serif">Merriweather (Serif)</option>
                                <option value="'Inter', sans-serif">Inter (Sans-serif)</option>
                                <option value="'Georgia', serif">Georgia (Classic)</option>
                                <option value="'Arial', sans-serif">Arial (Clean)</option>
                                <option value="'Times New Roman', serif">Times New Roman</option>
                                <option value="'Roboto', sans-serif">Roboto</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Code Font</label>
                            <select class="form-select" id="style-font-code" onchange="updateVisualStyle()">
                                <option value="'JetBrains Mono', monospace">JetBrains Mono</option>
                                <option value="'Fira Code', monospace">Fira Code</option>
                                <option value="'Source Code Pro', monospace">Source Code Pro</option>
                                <option value="'Monaco', monospace">Monaco</option>
                                <option value="'Consolas', monospace">Consolas</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Font Size: <span id="font-size-value">11pt</span></label>
                        <div class="range-container">
                            <input type="range" class="range-input" id="style-font-size" min="8" max="18" value="11" onchange="updateVisualStyle()">
                            <span class="range-value" id="style-font-size-display">11pt</span>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Line Height: <span id="line-height-value">1.7</span></label>
                        <div class="range-container">
                            <input type="range" class="range-input" id="style-line-height" min="1" max="2.5" step="0.1" value="1.7" onchange="updateVisualStyle()">
                            <span class="range-value" id="style-line-height-display">1.7</span>
                        </div>
                    </div>

                    <div class="section-divider"><span>Colors</span></div>

                    <div class="form-row-3">
                        <div class="form-group">
                            <label class="form-label">Background</label>
                            <div class="color-input-wrapper">
                                <input type="color" class="color-input" id="style-bg-color" value="#ffffff" onchange="updateVisualStyle()">
                                <input type="text" class="color-hex" id="style-bg-color-hex" value="#ffffff" onchange="syncColorFromHex('style-bg-color')">
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Text Color</label>
                            <div class="color-input-wrapper">
                                <input type="color" class="color-input" id="style-text-color" value="#333333" onchange="updateVisualStyle()">
                                <input type="text" class="color-hex" id="style-text-color-hex" value="#333333" onchange="syncColorFromHex('style-text-color')">
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Accent Color</label>
                            <div class="color-input-wrapper">
                                <input type="color" class="color-input" id="style-accent-color" value="#6366f1" onchange="updateVisualStyle()">
                                <input type="text" class="color-hex" id="style-accent-color-hex" value="#6366f1" onchange="syncColorFromHex('style-accent-color')">
                            </div>
                        </div>
                    </div>

                    <div class="section-divider"><span>Spacing</span></div>

                    <div class="form-group">
                        <label class="form-label">Page Padding: <span id="padding-value">20mm</span></label>
                        <div class="range-container">
                            <input type="range" class="range-input" id="style-padding" min="10" max="40" value="20" onchange="updateVisualStyle()">
                            <span class="range-value" id="style-padding-display">20mm</span>
                        </div>
                    </div>

                    <div class="section-divider"><span>Quick Presets</span></div>
                    
                    <div class="css-presets">
                        <button class="preset-btn" onclick="applyPreset('default')">Default</button>
                        <button class="preset-btn" onclick="applyPreset('academic')">Academic</button>
                        <button class="preset-btn" onclick="applyPreset('minimal')">Minimal</button>
                        <button class="preset-btn" onclick="applyPreset('dark')">Dark Mode</button>
                        <button class="preset-btn" onclick="applyPreset('colorful')">Colorful</button>
                    </div>
                </div>

                <!-- CSS Code Tab -->
                <div class="tab-content" id="content-code">
                    <div class="css-editor-header">
                        <span class="form-label" style="margin: 0;">Custom CSS for Preview</span>
                        <div class="css-editor-actions">
                            <button class="css-btn" onclick="formatCSS()"><i class="ph ph-magic-wand"></i> Format</button>
                            <button class="css-btn" onclick="resetCSS()"><i class="ph ph-arrow-counter-clockwise"></i> Reset</button>
                            <button class="css-btn" onclick="copyCSS()"><i class="ph ph-copy"></i> Copy</button>
                        </div>
                    </div>
                    <textarea class="css-editor" id="css-code-editor" placeholder="/* Add your custom CSS here */&#10;&#10;#preview-render {&#10;  /* Your styles */&#10;}" spellcheck="false"></textarea>
                    <p style="font-size: 0.75rem; color: var(--text-muted); margin-top: 12px;">
                        <i class="ph ph-info"></i> Target <code>#preview-render</code> and its child elements. Changes apply in real-time.
                    </p>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn secondary" onclick="exportStyles()"><i class="ph ph-export"></i> Export CSS</button>
                <button class="btn secondary" onclick="importStyles()"><i class="ph ph-download"></i> Import CSS</button>
                <button class="btn primary" onclick="closeStyleEditor()"><i class="ph ph-check"></i> Apply & Close</button>
            </div>
        </div>
    </div>

    <!-- Hidden import input -->
    <input type="file" id="css-import-input" accept=".css,.txt" style="display: none;">

</body>
</html>
